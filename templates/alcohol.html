<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ calc.icon }} {{ calc.name }} | Fitness Fixe</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #f9fafb; }
    .card { border-radius: 14px; box-shadow: 0 6px 24px rgba(0,0,0,0.06); }
    .result-box { background: #eef2ff; border-radius: 10px; padding: 18px; }
    canvas { max-height: 240px; }
    .progress { height: 26px; font-weight: bold; }
  </style>
</head>
<body>
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card p-4">
        <h2 class="text-center mb-4">{{ calc.icon }} {{ calc.name }}</h2>

        <!-- Input Form -->
        <form method="POST">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Drinks per Week</label>
              <input type="number" class="form-control" name="drinks" min="0" required>
              <small class="text-muted">
                1 drink = üç∫ 350ml beer (5%) | üç∑ 150ml wine (12%) | ü•É 45ml spirits (40%)
              </small>
            </div>
            <div class="col-md-6">
              <label class="form-label">Gender</label>
              <select class="form-select" name="gender">
                <option value="male">Male</option>
                <option value="female">Female</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Weight (optional, kg)</label>
              <input type="number" step="0.1" class="form-control" name="weight">
            </div>
            <div class="col-md-6">
              <label class="form-label">Drinking Pattern</label>
              <select class="form-select" name="pattern">
                <option value="spread">Spread across week</option>
                <option value="binge">Mostly binge</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-primary w-100 mt-3">Check Impact</button>
        </form>

        {% if result %}
        <div class="result-box mt-4">
          {% if result.error %}
            <div class="alert alert-danger">{{ result.error }}</div>
          {% else %}
            <h4 class="text-center mb-3">üç∫ Alcohol Impact Report</h4>

            <ul class="list-group mb-3">
              <li class="list-group-item">Drinks per Week: <strong>{{ result.drinks }}</strong></li>
              <li class="list-group-item">Total Alcohol: <strong>{{ result.ethanol }} g/week</strong></li>
              <li class="list-group-item">Gender: <strong>{{ result.gender }}</strong></li>
              {% if result.weight %}<li class="list-group-item">Weight: <strong>{{ result.weight }} kg</strong></li>{% endif %}
              <li class="list-group-item">Pattern: <strong>{{ result.pattern|capitalize }}</strong></li>
              <li class="list-group-item">Risk Category: <strong>{{ result.category }}</strong></li>
              <li class="list-group-item">Safe Limit: <strong>{{ result.safe_limit }} drinks ({{ result.safe_ethanol }} g)</strong></li>
            </ul>

            <!-- Gauge -->
            <div class="text-center mb-4">
              <canvas id="alcoholGauge"></canvas>
            </div>

            <!-- Comparison Bar -->
            <h6 class="text-center">Your Weekly Intake vs Safe Limit</h6>
            <div class="progress mb-2">
              <div class="progress-bar 
                {% if result.compare_pct <= 100 %}bg-success
                {% elif result.compare_pct <= 150 %}bg-warning
                {% else %}bg-danger{% endif %}"
                role="progressbar"
                style="width: {{ result.compare_pct }}%;"
                aria-valuenow="{{ result.compare_pct }}" aria-valuemin="0" aria-valuemax="200">
                {{ result.ethanol }} g / {{ result.safe_ethanol }} g
              </div>
            </div>
            <small class="text-muted d-block text-center">Safe limit = {{ result.safe_limit }} drinks ({{ result.safe_ethanol }} g) per week</small>

            <div class="alert alert-info text-center mt-3">{{ result.advice }}</div>

            <!-- Lifestyle Tips -->
            <h5 class="mt-4 text-center">üí° Lifestyle Tips</h5>
            <ul class="list-group mb-3">
              {% for tip in result.tips %}
                <li class="list-group-item">‚úîÔ∏è {{ tip }}</li>
              {% endfor %}
            </ul>

            <!-- Reference Table -->
            <h5 class="mt-4 text-center">üìä Alcohol Guidelines</h5>
            <div class="table-responsive">
              <table class="table table-bordered text-center">
                <thead class="table-light">
                  <tr>
                    <th>Risk Level</th>
                    <th>Male</th>
                    <th>Female</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Low Risk</td>
                    <td>‚â§14 drinks/week</td>
                    <td>‚â§7 drinks/week</td>
                  </tr>
                  <tr>
                    <td>Moderate Risk</td>
                    <td>15‚Äì28 drinks/week</td>
                    <td>8‚Äì14 drinks/week</td>
                  </tr>
                  <tr>
                    <td>High Risk</td>
                    <td>&gt;28 drinks/week</td>
                    <td>&gt;14 drinks/week</td>
                  </tr>
                </tbody>
              </table>
            </div>
          {% endif %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
{% if result %}
const ctx = document.getElementById('alcoholGauge').getContext('2d');
new Chart(ctx, {
  type: 'doughnut',
  data: {
    datasets: [{
      data: [{{ result.score }}, {{ 100 - result.score }}],
      backgroundColor: [
        '{{ "#4caf50" if result.category=="Low Risk" else "#ffc107" if "Moderate" in result.category else "#f44336" }}',
        '#e0e0e0'
      ]
    }]
  },
  options: {
    rotation: -90,
    circumference: 180,
    cutout: '70%',
    plugins: { legend: { display: false }, tooltip: { enabled: false } }
  }
});
{% endif %}
</script>
</body>
</html>
